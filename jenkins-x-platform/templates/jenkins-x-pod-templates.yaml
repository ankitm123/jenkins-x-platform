{{- define "container" }}
  {{- if ne "Jnlp" .ckey }}
      - name: {{ .ckey | lower }}
        image: {{ .cval.Image }}
  {{- if .cval.Args }}
        args:
        {{- range $arg := splitList " " .cval.Args }}
        - {{ $arg }}
        {{- end }}
  {{- end }}
  {{- if .cval.Command }}
        command:
        {{- range $cmd := splitList " " .cval.Command }}
        - {{ $cmd }}
        {{- end }}
  {{- end }}
        workingDir: /home/jenkins
        securityContext:
          privileged: {{ default false .cval.Privileged }}
  {{- if .cval.AlwaysPullImage }}
        imagePullPolicy: Always
  {{- end }}
        tty: {{ default false .cval.Tty }}
        env:
        - name: DOCKER_REGISTRY
          valueFrom:
            configMapKeyRef:
              name: jenkins-x-docker-registry
              key: docker.registry
  {{- if .globalenv.TILLER_NAMESPACE }}
        - name: TILLER_NAMESPACE
          value: {{ .globalenv.TILLER_NAMESPACE }}
  {{- end }}
  {{- range $ekey, $eval := .pval.EnvVars }}
        - name: {{ $ekey }}
          value: {{ $eval }}
  {{- end }}
        resources:
          requests:
            cpu: {{ .cval.RequestCpu }}
            memory: {{ .cval.RequestMemory }}
          limits:
  {{- if .cval.LimitCpu }}
            cpu: {{ .cval.LimitCpu }}
  {{- end }}
  {{- if .cval.LimitMemory }}
            memory: {{ .cval.LimitMemory }}
  {{- end }}
        volumeMounts:
          - mountPath: /home/jenkins
            name: workspace-volume
  {{- if .agent.DockerHostPath }}
          - name: docker-daemon
            mountPath: {{ .agent.DockerMountPath }}
  {{- end }}
  {{- range $index, $volume := .pval.volumes }}
          - name: volume-{{ $index }}
            mountPath: {{ $volume.mountPath }}
  {{- end }}
  {{- end }}
{{- end }}
